This was liberally stolen and adapted from libopencm3-examples/examples/stm32/f1/stm32-h103/usb_dfu/.
